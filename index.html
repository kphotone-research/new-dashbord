<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kphotone – Member Login</title>
  <style>
    body { margin:0; padding:0; font-family:Arial; background:#f4f8ff; }
    .header { background: linear-gradient(90deg, #005eff, #002d73); padding:25px; text-align:center; color:white; font-size:24px; font-weight:bold; }
    .logo { width:130px; margin:20px auto; display:block; }
    .container { max-width:500px; background:white; margin:30px auto; padding:30px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
    .container h2 { text-align:center; color:#002d73; margin-bottom:25px; }
    label { display:block; margin-top:15px; font-weight:bold; color:#1a1a1a; }
    input { width:100%; padding:12px; margin-top:6px; border:1px solid #cbd5e0; border-radius:8px; font-size:15px; }
    .btn { width:100%; padding:12px; margin-top:25px; background:#005eff; border:none; border-radius:8px; color:white; font-size:16px; cursor:pointer; transition:0.3s; }
    .btn:hover { background:#003da8; }
    .error { color:red; margin-top:10px; font-size:14px; text-align:center; display:none; }
    .support { margin-top:20px; text-align:center; font-size:14px; color:#333; }
  </style>
</head>
<body>
  <div class="header">Member Login – Kphotone Healthcare Network</div>
  <img class="logo" src="https://raw.githubusercontent.com/kphotone-research/Images-kphotone/main/Logo.png" alt="Kphotone Logo" />
  <div class="container">
    <h2>Sign in to Your Account</h2>
    <label for="email">Email Address</label>
    <input type="email" id="email" placeholder="Enter your registered email" />
    <label for="password">Password</label>
    <input type="password" id="password" placeholder="Enter your password" />
    <button class="btn" onclick="login()">Login</button>
    <p class="error" id="errorMessage"></p>
    <p class="support">Having trouble logging in?<br/>Contact us: <strong>support@kphotone.com</strong></p>
  </div>

  <script>
    async function login() {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      const errorMessage = document.getElementById("errorMessage");
      errorMessage.style.display = "none";

      if (!email || !password) {
        errorMessage.innerText = "Please enter both email and password.";
        errorMessage.style.display = "block";
        return;
      }

      const url = "https://script.google.com/macros/s/AKfycbxlmFaghS0f-foohGtcKMoODiDu-G-99KCUJ5-BmyONd1FM_Dnw4YZ2qg26qGqOx4I1Qw/exec";

      const body = new URLSearchParams();
      body.append("action", "login");
      body.append("email", email);
      body.append("password", password);

      try {
        const res = await fetch(url, {
          method: "POST",
          body: body
        });
        const data = await res.json();

        if (!data.success) {
          errorMessage.innerText = data.message || "Login failed.";
          errorMessage.style.display = "block";
          return;
        }

        if (data.resetRequired) {
          localStorage.setItem("resetEmail", email);
          window.location.href = "reset.html";
          return;
        }

        localStorage.setItem("kp_user_email", email);
        localStorage.setItem("kp_user_fullname", data.fullName || "");
        window.location.href = "dashboard.html";

      } catch (err) {
        console.error(err);
        errorMessage.innerText = "Unable to connect to server. Please try later.";
        errorMessage.style.display = "block";
      }
    }
  </script>
</body>
</html>
